<!doctype html><html lang=zh dir=ltr><head><meta name=generator content="Hugo 0.74.3"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="什么是数据 #  功能概述 #  数据通道可以传送任何类型的数据。您也可以通过数据通道发送音频或视频数据，但是如果需要实时播放媒体，使用基于RTP/RTCP协议的媒体通道是更好的选择（请参阅媒体通信）。
数据通道有哪些应用？ #  数据通道的适用性是无限的！数据通道为您解决了数据包丢失，拥塞问题和许多其他问题。它提供了非常简单的API，让您将数据实时交付给对端peer。您只需要关注应用程序想要实现的目标即可。
以下是一些使用数据通道的示例应用：
 实时网络游戏 远程无服务器家庭自动化 文字聊天 动画（一系列静止图像） P2P CDN（内容交付网络） 监控物联网数据 从传感器设备持续提取时间序列数据 从相机获取实时图像并利用AI进行图像识别  协议栈概述 #  数据通道由以下3层组成：
 数据通道层 DCEP（数据通道建立协议）层 SCTP（流控制传输协议）层    数据通道层 #  该层提供了API。该API大体上是对WebSocket的模拟，从而使Web开发人员能相对容易的将现有的基于WebSocket的客户端-服务器的代码修改为使用P2P数据通道实现。单一的peer连接可以包含peer之间的多条数据通道，从而省去了从多个数据源和接收器复用和解复用的麻烦。只需要为交换的每一类数据创建一个数据通道，其余的工作都交给peer连接完成。与WebSockets不同的一点是，数据通道具有创建者分配的标签，接收者可以使用标签来确定数据通道的身份。
数据通道建立协议层 #  该层负责与对端peer建立数据通道握手。它使用SCTP流作为控制通道来协商诸如有序交付，maxRetransmits（最大重传）/ maxPacketLifeTime（最大包生命周期）（也就是&#34;部分可靠性&#34;选项），发送频道的标签等等。
SCTP协议层 #  这是数据通道的核心。它包括：
 通道复用（在SCTP中，通道称为&#34;流&rdquo;） 使用类似TCP的重传机制进行可靠传递 部分可靠性选项 避免拥塞 流量控制  Data Channel API #  Connection / Teardown #  Data Channel Options #  Flow Control API #  Data Channel in Depth #  SCTP #  Connection establishment flow #  Connection teardown flow #  Keep-alive mechanism #  How does a user message get sent?"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="数据通信"><meta property="og:description" content="什么是数据 #  功能概述 #  数据通道可以传送任何类型的数据。您也可以通过数据通道发送音频或视频数据，但是如果需要实时播放媒体，使用基于RTP/RTCP协议的媒体通道是更好的选择（请参阅媒体通信）。
数据通道有哪些应用？ #  数据通道的适用性是无限的！数据通道为您解决了数据包丢失，拥塞问题和许多其他问题。它提供了非常简单的API，让您将数据实时交付给对端peer。您只需要关注应用程序想要实现的目标即可。
以下是一些使用数据通道的示例应用：
 实时网络游戏 远程无服务器家庭自动化 文字聊天 动画（一系列静止图像） P2P CDN（内容交付网络） 监控物联网数据 从传感器设备持续提取时间序列数据 从相机获取实时图像并利用AI进行图像识别  协议栈概述 #  数据通道由以下3层组成：
 数据通道层 DCEP（数据通道建立协议）层 SCTP（流控制传输协议）层    数据通道层 #  该层提供了API。该API大体上是对WebSocket的模拟，从而使Web开发人员能相对容易的将现有的基于WebSocket的客户端-服务器的代码修改为使用P2P数据通道实现。单一的peer连接可以包含peer之间的多条数据通道，从而省去了从多个数据源和接收器复用和解复用的麻烦。只需要为交换的每一类数据创建一个数据通道，其余的工作都交给peer连接完成。与WebSockets不同的一点是，数据通道具有创建者分配的标签，接收者可以使用标签来确定数据通道的身份。
数据通道建立协议层 #  该层负责与对端peer建立数据通道握手。它使用SCTP流作为控制通道来协商诸如有序交付，maxRetransmits（最大重传）/ maxPacketLifeTime（最大包生命周期）（也就是&#34;部分可靠性&#34;选项），发送频道的标签等等。
SCTP协议层 #  这是数据通道的核心。它包括：
 通道复用（在SCTP中，通道称为&#34;流&rdquo;） 使用类似TCP的重传机制进行可靠传递 部分可靠性选项 避免拥塞 流量控制  Data Channel API #  Connection / Teardown #  Data Channel Options #  Flow Control API #  Data Channel in Depth #  SCTP #  Connection establishment flow #  Connection teardown flow #  Keep-alive mechanism #  How does a user message get sent?"><meta property="og:type" content="article"><meta property="og:url" content="https://webrtcforthecurious.com/zh/docs/07-data-communication/"><meta property="article:modified_time" content="2021-03-01T18:10:32+08:00"><meta property="og:site_name" content="给好奇者的WebRTC"><title>数据通信 | 给好奇者的WebRTC</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=https://webrtcforthecurious.com/docs/07-data-communication/ title="Data Communication"><link rel=alternate hreflang=tr href=https://webrtcforthecurious.com/tr/docs/07-data-communication/ title="Data Communication"><link rel=stylesheet href=/book.min.6c7c6446dfdee7c8c933e9bbc6e80ee3ed6c913b2a59519f2092c3c6a9d63e55.css integrity="sha256-bHxkRt/e58jJM+m7xugO4+1skTsqWVGfIJLDxqnWPlU="><script defer src=/zh.search.min.9da0e0c9e811421630eb5c26f62a8bbf95b534dcd272128eefa8829004db3c3d.js integrity="sha256-naDgyegRQhYw61wm9iqLv5W1NNzSchKO76iCkATbPD0="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/zh><span>给好奇者的WebRTC</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://webrtcforthecurious.com/zh/docs/01-what-why-and-how/>是什么，为什么，如何使用</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/02-signaling/>信令</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/03-connecting/>连接</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/04-securing/>安全性</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/05-real-time-networking/>实时联网</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/06-media-communication/>媒体通信</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/07-data-communication/ class=active>数据通信</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/08-applied-webrtc/>WebRTC应用场景</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/09-debugging/>调试</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/10-history-of-webrtc/>历史</a></li><li><a href=https://webrtcforthecurious.com/zh/docs/11-faq/>常见问题</a></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>数据通信</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#功能概述>功能概述</a><ul><li><a href=#数据通道有哪些应用>数据通道有哪些应用？</a></li><li><a href=#协议栈概述>协议栈概述</a></li></ul></li><li><a href=#data-channel-api>Data Channel API</a><ul><li><a href=#connection--teardown>Connection / Teardown</a></li><li><a href=#data-channel-options>Data Channel Options</a></li><li><a href=#flow-control-api>Flow Control API</a></li></ul></li><li><a href=#data-channel-in-depth>Data Channel in Depth</a><ul><li><a href=#sctp>SCTP</a></li><li><a href=#dcepdata-channel-establishment-protocol数据通道建立协议>DCEP（Data Channel Establishment Protocol/数据通道建立协议）</a></li></ul></li><li><a href=#rfc链接>RFC链接</a></li></ul></nav></aside></header><article class=markdown><h1 id=什么是数据>什么是数据
<a class=anchor href=#%e4%bb%80%e4%b9%88%e6%98%af%e6%95%b0%e6%8d%ae>#</a></h1><h2 id=功能概述>功能概述
<a class=anchor href=#%e5%8a%9f%e8%83%bd%e6%a6%82%e8%bf%b0>#</a></h2><p>数据通道可以传送任何类型的数据。您也可以通过数据通道发送音频或视频数据，但是如果需要实时播放媒体，使用基于RTP/RTCP协议的媒体通道是更好的选择（请参阅<a href=https://webrtcforthecurious.com/zh/docs/06-media-communication/>媒体通信</a>）。</p><h3 id=数据通道有哪些应用>数据通道有哪些应用？
<a class=anchor href=#%e6%95%b0%e6%8d%ae%e9%80%9a%e9%81%93%e6%9c%89%e5%93%aa%e4%ba%9b%e5%ba%94%e7%94%a8>#</a></h3><p>数据通道的适用性是无限的！数据通道为您解决了数据包丢失，拥塞问题和许多其他问题。它提供了非常简单的API，让您将数据实时交付给对端peer。您只需要关注应用程序想要实现的目标即可。</p><p>以下是一些使用数据通道的示例应用：</p><ul><li>实时网络游戏</li><li>远程无服务器家庭自动化</li><li>文字聊天</li><li>动画（一系列静止图像）</li><li>P2P CDN（内容交付网络）</li><li>监控物联网数据</li><li>从传感器设备持续提取时间序列数据</li><li>从相机获取实时图像并利用AI进行图像识别</li></ul><h3 id=协议栈概述>协议栈概述
<a class=anchor href=#%e5%8d%8f%e8%ae%ae%e6%a0%88%e6%a6%82%e8%bf%b0>#</a></h3><p>数据通道由以下3层组成：</p><ul><li>数据通道层</li><li>DCEP（数据通道建立协议）层</li><li>SCTP（流控制传输协议）层</li></ul><figure><img src=/images/06-datachan-proto-stack.png></figure><h4 id=数据通道层>数据通道层
<a class=anchor href=#%e6%95%b0%e6%8d%ae%e9%80%9a%e9%81%93%e5%b1%82>#</a></h4><p>该层提供了API。该API大体上是对WebSocket的模拟，从而使Web开发人员能相对容易的将现有的基于WebSocket的客户端-服务器的代码修改为使用P2P数据通道实现。单一的peer连接可以包含peer之间的多条数据通道，从而省去了从多个数据源和接收器复用和解复用的麻烦。只需要为交换的每一类数据创建一个数据通道，其余的工作都交给peer连接完成。与WebSockets不同的一点是，数据通道具有创建者分配的标签，接收者可以使用标签来确定数据通道的身份。</p><h4 id=数据通道建立协议层>数据通道建立协议层
<a class=anchor href=#%e6%95%b0%e6%8d%ae%e9%80%9a%e9%81%93%e5%bb%ba%e7%ab%8b%e5%8d%8f%e8%ae%ae%e5%b1%82>#</a></h4><p>该层负责与对端peer建立数据通道握手。它使用SCTP流作为控制通道来协商诸如有序交付，maxRetransmits（最大重传）/ maxPacketLifeTime（最大包生命周期）（也就是"部分可靠性"选项），发送频道的标签等等。</p><h4 id=sctp协议层>SCTP协议层
<a class=anchor href=#sctp%e5%8d%8f%e8%ae%ae%e5%b1%82>#</a></h4><p>这是数据通道的核心。它包括：</p><ul><li>通道复用（在SCTP中，通道称为"流&rdquo;）</li><li>使用类似TCP的重传机制进行可靠传递</li><li>部分可靠性选项</li><li>避免拥塞</li><li>流量控制</li></ul><h2 id=data-channel-api>Data Channel API
<a class=anchor href=#data-channel-api>#</a></h2><h3 id=connection--teardown>Connection / Teardown
<a class=anchor href=#connection--teardown>#</a></h3><h3 id=data-channel-options>Data Channel Options
<a class=anchor href=#data-channel-options>#</a></h3><h3 id=flow-control-api>Flow Control API
<a class=anchor href=#flow-control-api>#</a></h3><h2 id=data-channel-in-depth>Data Channel in Depth
<a class=anchor href=#data-channel-in-depth>#</a></h2><h3 id=sctp>SCTP
<a class=anchor href=#sctp>#</a></h3><h4 id=connection-establishment-flow>Connection establishment flow
<a class=anchor href=#connection-establishment-flow>#</a></h4><h4 id=connection-teardown-flow>Connection teardown flow
<a class=anchor href=#connection-teardown-flow>#</a></h4><h4 id=keep-alive-mechanism>Keep-alive mechanism
<a class=anchor href=#keep-alive-mechanism>#</a></h4><h4 id=how-does-a-user-message-get-sent>How does a user message get sent?
<a class=anchor href=#how-does-a-user-message-get-sent>#</a></h4><h4 id=tsn-and-retransmission>TSN and retransmission
<a class=anchor href=#tsn-and-retransmission>#</a></h4><h4 id=congestion-avoidance>Congestion avoidance
<a class=anchor href=#congestion-avoidance>#</a></h4><h4 id=selective-ack>Selective ACK
<a class=anchor href=#selective-ack>#</a></h4><h4 id=fast-retransmissionrecovery>Fast retransmission/recovery
<a class=anchor href=#fast-retransmissionrecovery>#</a></h4><h4 id=partial-reliability>Partial Reliability
<a class=anchor href=#partial-reliability>#</a></h4><h3 id=dcepdata-channel-establishment-protocol数据通道建立协议>DCEP（Data Channel Establishment Protocol/数据通道建立协议）
<a class=anchor href=#dcepdata-channel-establishment-protocol%e6%95%b0%e6%8d%ae%e9%80%9a%e9%81%93%e5%bb%ba%e7%ab%8b%e5%8d%8f%e8%ae%ae>#</a></h3><p>DCEP是一个简单到只有两个数据包的协议，它描述了建立数据通道的行为。它不需要等待握手完成，因此该通道的后续数据可以包含在同一数据包中。这使得建立数据通道更加快速，而且成本更低。</p><h4 id=openack-handshake握手>Open/ACK handshake（握手）
<a class=anchor href=#openack-handshake%e6%8f%a1%e6%89%8b>#</a></h4><pre><code>0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |  Message Type |  Channel Type |            Priority           |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                    Reliability Parameter                      |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |         Label Length          |       Protocol Length         |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \                                                               /
     |                             Label                             |
     /                                                               \
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \                                                               /
     |                            Protocol                           |
     /                                                               \
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre><p>这里是通道类型以及相关的可靠性参数的列表，在数据包丢失或乱序接收时，可以调整这些参数。</p><pre><code>DATA_CHANNEL_OPEN
Message Type: 0x03
     +================================================+=============+
     | Channel Type                                   | Reliability |
     |                                                |  Parameter  |
     +================================================+=============+
     | DATA_CHANNEL_RELIABLE                          |   Ignored   |
     +------------------------------------------------+-------------+
     | DATA_CHANNEL_RELIABLE_UNORDERED                |   Ignored   |
     +------------------------------------------------+-------------+
     | DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT           |  Number of  |
     |                                                |     RTX     |
     +------------------------------------------------+-------------+
     | DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT_UNORDERED |  Number of  |
     |                                                |     RTX     |
     +------------------------------------------------+-------------+
     | DATA_CHANNEL_PARTIAL_RELIABLE_TIMED            | Lifetime in |
     |                                                |      ms     |
     +------------------------------------------------+-------------+
     | DATA_CHANNEL_PARTIAL_RELIABLE_TIMED_UNORDERED  | Lifetime in |
     |                                                |      ms     |
     +------------------------------------------------+-------------+
</code></pre><p>数据通道的可靠性大体上等同于TCP。</p><p>需要特别提一下Reliable_Unordered。这种模式意味着，如果一个数据包因为网络原因丢失时，只有包含这个数据包的消息会被延后，直到重新发送为止。在这个消息之后发送的其他消息可能会更早到达。当接收消息的顺序不如消息到达的速度重要时，就可以使用这种模式。在这种模式下，仍然强制执行消息传递，但传递顺序不是强制的。可以将这种模式视为TCP和UDP之间的折衷方案。</p><p>其他的模式等价于基于UDP，但具有不同的重试/失败规则的协议。</p><pre><code>DATA_CHANNEL_ACK
Message Type: 0x02

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |  Message Type |
     +-+-+-+-+-+-+-+-+

</code></pre><p>没有DCEP NACK（译注：即数据通道建立失败）。
数据通道的打开始终会成功，因为它们的传输是在已经成功建立的SCTP流上进行！</p><h4 id=ppidpayload-protocol-identifier有效载荷协议标识符>PPID（Payload Protocol Identifier/有效载荷协议标识符）
<a class=anchor href=#ppidpayload-protocol-identifier%e6%9c%89%e6%95%88%e8%bd%bd%e8%8d%b7%e5%8d%8f%e8%ae%ae%e6%a0%87%e8%af%86%e7%ac%a6>#</a></h4><p>WebRTC DCEP的SCTP PPID为50。DCEP消息与SCTP流中的其余数据分开处理，并且不会传递回Web应用程序或服务。</p><h4 id=参数交换>参数交换
<a class=anchor href=#%e5%8f%82%e6%95%b0%e4%ba%a4%e6%8d%a2>#</a></h4><p>理论上讲，可以使用out-of-band的SDP中非DCEP协商的方式来创建数据通道。不要这样。</p><h2 id=rfc链接>RFC链接
<a class=anchor href=#rfc%e9%93%be%e6%8e%a5>#</a></h2><p><a href="https://datatracker.ietf.org/doc/rfc8832/?include_text=1">https://datatracker.ietf.org/doc/rfc8832/?include_text=1</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
简体中文</li></ul><ul class=book-languages-list><li><a href=https://webrtcforthecurious.com/docs/07-data-communication/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=https://webrtcforthecurious.com/tr/docs/07-data-communication/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Turkish</a></li><li><a href=https://webrtcforthecurious.com/fa/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Persian</a></li><li class=active><a href=https://webrtcforthecurious.com/zh/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></li></ul></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/commit/03170d9f152cbb92aae773c54563736c1623b6bd title="最后修改者 Cliff Han | March 1, 2021" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 1, 2021</span></a></div><div><a class="flex align-center" href=https://github.com/webrtc-for-the-curious/webrtc-for-the-curious/edit/master/content/content.zh-cn/docs/07-data-communication.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#功能概述>功能概述</a><ul><li><a href=#数据通道有哪些应用>数据通道有哪些应用？</a></li><li><a href=#协议栈概述>协议栈概述</a></li></ul></li><li><a href=#data-channel-api>Data Channel API</a><ul><li><a href=#connection--teardown>Connection / Teardown</a></li><li><a href=#data-channel-options>Data Channel Options</a></li><li><a href=#flow-control-api>Flow Control API</a></li></ul></li><li><a href=#data-channel-in-depth>Data Channel in Depth</a><ul><li><a href=#sctp>SCTP</a></li><li><a href=#dcepdata-channel-establishment-protocol数据通道建立协议>DCEP（Data Channel Establishment Protocol/数据通道建立协议）</a></li></ul></li><li><a href=#rfc链接>RFC链接</a></li></ul></nav></div></aside></main></body></html>